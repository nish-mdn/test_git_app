#sudo: true
language: ruby
rvm: "2.3.1"
conditions: v0
stages:
  - name: staging
jobs:
  include:
    - stage: staging
      addons:
        artifacts:
          paths:
            - $(git ls-files | tr "\n" ":")
          target_paths:
            - my-test-build/blog
          debug: true
      env:
        - secure: "EH+nZmMyDWUzhVzlN/Dn76u8xpWHpRWJGxOBmzjh4Tm7nf46wYX78n2287K4BUvjo0lo7L1WZ8A0ybr+C36eK5ndHw7VtEj8AFPjKhMMMWBXl97uBCb/ZBuN61WQ/j9Bc1Rm68xmCdLyMfN5OgwUW3p1C5ZmLH8HtIFowmbmwBidkD/VryVxGEis6G1Pwo8LjR/av9qdqyqmwXEa+l8tBh9KAKYcLA6JqTDyCfKbGSFtQhds81kzED71b/8x9cQJHZk5+pfKLJnusMcaItjpyu5JvZbGuzlyjeQ7g1Pd5Qp6KKYJMfred75dx2IwZ2/fKh9gYzonT//pTainnQS9MAvEQEf4QJ1G94rkVLUYVQBBDvHxXRNbxGQ/cMQGH+zcSXULRjCnLiEcBzVhILQJLJcmktZ6Z3IB73cVYnaRfBxbmRPv1B4C1Kxoc2acoQZKPLQ1EC7+OcUruB+Os7A7L2wdJ+Hv9cdWwYMlwVgbiFQW665fps0CBHd7Qwhft0f7iIutF4+QfgQ6NPax3vsS6keXIxUNQkhAJxh7JSPDXG85/8nczb5dzXUoWMEGt75EdpTtcjRhHEVTOURSfF1hPnmIyZ3XSIk8OPtdsmFge6YmLGNmZnyeWdpn7a9C2wiaTwYSu5q4VNe+PNv0qPtwS9S8J9FsVwu5v/GuoBZCfh8="
        - secure: "f2QrrDCxnxLwH4inbv/CgWZZYzwl1zLUfVFjQB0ZvJdbU0mETKlGR1jJ/JHrgh40nN5WW9a3v5qURETt7TlV57QadcsjOPrH+1GP11wKF72dO81YMeLlM1sS8KirSxhl1656YyBiyKtpJr2aWMCs8e/mClFgmKP5nM5tm6zn4iEN9ERF/Nd0rVnMhNsq3lvCtJWSfs3sPfssOg7rkgcLl6gxEW9ys0r5uII0nUcfFW65SBZNlt2US+/hyz/zt+il6rtLr4rya4/XtIQ8r4aGKS+UO/3TCIj0dFyjcv59yxYimWZDpONZPWz1P47jsKbcAlFV8CO2XxXNaUXMX61SqFBYs7E0kq6fqqNkCA6Lcaw6+YT1r3JtOgNaR7lMdpDT9f7kZuGU05Bhq4GtsSLtXEsdriI+LSu6/dfgk7xfHJU2Gh2VQfAcNfcVd/DQyzRqiwPiFyn06jeDabvnmCx5LQZNPub+irLJtL8Oa3M8ciWLu7UMqKubqsAn28/J0XrYVc/DGlueb5HR+4WRdbU9yGA7CjGQe43bQ1SfZduMQHR5rN7eeo28TzNW0Ac1y/RddN2no3ommPY0sm63gvFM1AhnZk6KyH+5ch5woiCZrJ4QC6VQuZ/sPJXau2HbBCmLhUA1nV23C+SAItAQxHy1CB5pJr18Lp2c3MDZu39VZXg="
        - secure: "bByUPkqzM37br6s6MIKV2PtjoepWh4Y89a/I6FmoAVtgGKqYC/d57ENnUdUbPapg4MmvsvSmmtlt2+qq93SdKly4XPGW9fGK/p/84Mo/RUlFUhwJVDM85zexfzDvm05YMcYsLcYKSssW55HImdhK2TKc9pYXEsucVTpbBDsLZyBOeuOUlPk2aIjDrdzkSfIPOH5KgnBAXLYRj/E90SufyNc346qIjFgJQ12muXQtq+JK5/ivu8/fnAnnnqEhp2LP/Wmt8L+6nv0/MgxCapjbeOPUbXQADc6vvYS7XVbEH73c5NyUEcYLhJ1Papb+ka6zK8USDQnGX8vPFsSRnWUqAPsBTWckEhQkP2eQurxuhJJr807C5SMtn2ZL5zpPfuQ4FzNOHRLCbKdmvfiayjhF6/Zu+wKz6IxFBOj90dh/NWK0Kk8oRD6IAHaFmEpirMQWFUCs8n62tgmPcVnB24PWCJps0/NsArDL8TbGeYcXGYPxbCvK0uVym1A1s6WYvTChaeM9fOrT/ZF6KFo6ruPaaPzIl3e+WhJbIEsS+TNAjQ8WMbqs11d0WT/sXghEdDbc4JmQSuf+BlozjYzuWTFf4VQJtXV7gRDMN3kfVFAQz+4SdvvICN3vQdO/VVlWXvp65BpfeYpoCjZFh7EDNnEeilLusJlUkRQ9yVJOJHg6Aak="  
        - secure: "y/o/SCgzgq+blj5MYMLV77yLY5yneIJL7auVho4SN6vRgXRmXiRyeb/Pptkbq/a5aeRVQDgTuz98lWqjlG7QrQxM+3hvsyOuGwvhquiAp9JrB2WEO3hdcLb48ryx6Dg2TMamewjxvuIX1XmJPsKYATZi/2y+T9VxM4/hnwyd18hFbIa9OwBn/DXVdWwoO3gm2fGJmm/jRblYSnXRcm819bj5lPX6hNnSF6W0cpHDSy054fDcPPEa9swnOiW1JOK3lvFvwpjcqrXQGGikEu4NGCYM6iKF+6Ag4jHWoFqWcAL2n/ZUNMsQZKY30uj9JRwmXO9Q2Zez5nxbmIVmFIzf6j4QN17iSrUCH2+cwsYUz9ZdOcwRxnU5mDKQQJnIW8bsRNH+osS0AeWI3jtyuVQK7Ijty+4poRN6IQakXRFDe/0PKQBmoQg3qpTM0yZ4Qp3s/wjaLai3Ih8IQDm1qAFe0FrAszJbM0TUCcilwweU5pEhgOScmprJHImpMsuV1hmEvFz5IjFMMsRowmjJMcYOQc71e07/3gCgTWznhbfrl9lXWFaVh282pqyuCtO0VX1rrMd+Eu81+x+SQmqkE17yTdjMn/5Q8Bcyyum6QO9q27VczH2KQbefSt34fl5hYQtek0MYwFC26qIpuT53SsT73HJVWSUtgklfJrhnyLPXhKM="
        - secure: "Sqz7iYWOdTPeGI1cqcWkeeIjf1KPnE+O8OIZPp3HWYzbcOTnAmaM0MzOK5U7Fii671ypIm6fqfctqU2d2Y3cKsWvoTLdvGLeoJE92Dvsl+FRmNGW18d7GaS3XDhRNpYK1aEYE7uTsHgn8HNz3xGOI3My9ClVp99PmhUX9IsqIkcT7NeVQmOGmsCPKbu52eUF9jzX1M+dmZpceABUYcRwXy055ZwAnKl3jGqGx2zcRHdEqjuMacci6/t1JdGxGThtHKf98Z2JQTeJ8Zr75wC3TKI0k/zBQBlza7vOLD+kS8ldckrpik0Wqceyoa5xz4VBFw3WRdiKETVGb5yzmDYoMjCDFtFHozq1od8A/Lcp3FPJRQIuj2VKSWoJmAIaGvDHTWmYjDN1miReAEogFDSVxyWurhBZQQQDj/NMX6lIQzoYHuj3pAF5P7SX0dw2w74qDYQraHfFUiiVIEAAneWtmpaZxuAxsQLJPuJP1GEKdhlVzaC3Oi6huX1BsNTCq8MiHZ+9K6B255yDQ2AArhTudGtMH4OWKMZN9LbORnwzT9AHFi3wxqqns+SDo4GDIFakqP5HACRWPuBK9P1pxKupkqmprb8XZTxDzh1MJ0W+DDY03Pq9EhDr2V2QKgMARloeNCrLDTtxDb8SPERw+N+ttt7w2lp3Jee9Gz7X9MTUMeo="
      if: branch =~ /^travis_aws_code_deploy*/
      before_script: 
        - cd blog
      script:
        - bundle install
        - bundle exec rspec
      deploy:  
        - provider: codedeploy
          access_key_id: $AWS_ACCESS_KEY
          secret_access_key: $AWS_SECRET_ACCESS_KEY
          bucket: "mdn-codedeploy-artifact"
          key: my-test-build/latest/artifact.zip
          bundle_type: zip
          application: mdn-codedeploy
          deployment_group: mdn_deployment_group
          on:
            all_branches: true

